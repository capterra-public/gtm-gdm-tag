___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Gartner Digital Markets Insights Tag",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "Gartner Digital Markets Insights Tag offers added visibility into buyer behavior and campaigns so you can maximize brand exposure and ROAS in an increasingly privacy-first world.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "vendorId",
    "displayName": "Vendor Id",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "vendorKey",
    "displayName": "Vendor Key",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const setInWindow = require('setInWindow');
const callInWindow = require('callInWindow');
const injectScript = require('injectScript');
const isConsentGranted = require('isConsentGranted');
const addConsentListener = require('addConsentListener');

const vendorId = data.vendorId;
const vendorKey = data.vendorKey;

const isStorageConsentGranted = isConsentGranted("ad_storage");

const url = "https://tr.capterra.com/static/wp.js";

function setConfig() {
  setInWindow('_ct', {
    vid: vendorId,
    vkey: vendorKey,
    uc: isStorageConsentGranted,
    hasDoNotTrackIPs: false,
  }, true);
}

function listenForConsentChanges () {
  addConsentListener("ad_storage", (consentType, granted) => {
    if (!granted) {
      callInWindow('ct.revokeConsent');
      return;
    }
    
    callInWindow('ct.grantConsent');
  });

}

if(vendorId && vendorKey){
  setConfig();
  listenForConsentChanges();
  injectScript(url, data.gtmOnSuccess, data.gtmOnFailure);
} else {
  data.gtmOnFailure();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://tr.capterra.com/static/wp.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_ct"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ct.grantConsent"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ct.revokeConsent"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_consent",
        "versionId": "1"
      },
      "param": [
        {
          "key": "consentTypes",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Missing Vendor Id
  code: |-
    const mockData = {
      venodrKey: "test-vkey"
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnFailure').wasCalled();
- name: Missing Vendor Key
  code: |-
    const mockData = {
      vendorId: "Test Vendor Id"
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnFailure').wasCalled();


___NOTES___

Created on 23/01/2025, 15:23:45


